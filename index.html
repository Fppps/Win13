<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Windows 13 Concept</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
    <style>
        body { font-family: 'Inter', sans-serif; user-select: none; color: #e0e0e0; background-color: #1a1a2e; }
        .font-mono { font-family: 'monospace'; }
        .material-symbols-outlined { font-variation-settings: 'FILL' 0, 'wght' 300, 'GRAD' 0, 'opsz' 24; }
        
        #desktop-container {
            background-image: radial-gradient(circle at top left, rgba(23, 42, 70, 0.8), transparent 40%), radial-gradient(circle at bottom right, rgba(67, 56, 202, 0.5), transparent 50%);
            opacity: 0;
            transition: opacity 0.5s ease-in-out;
        }

        .panel {
            background: rgba(0, 0, 0, 0.2);
            backdrop-filter: blur(5px);
            -webkit-backdrop-filter: blur(5px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        
        @keyframes open-animation { from { opacity: 0; transform: translateY(20px) scale(0.95); } to { opacity: 1; transform: translateY(0) scale(1); } }
        .animate-open { animation: open-animation 0.2s ease-out; }

        .window { transition: opacity 0.2s, transform 0.2s, top 0.2s, left 0.2s, width 0.2s, height 0.2s; min-width: 300px; min-height: 200px; }
        .title-bar { cursor: move; }
        
        .resize-handle { position: absolute; bottom: 0; right: 0; width: 16px; height: 16px; cursor: se-resize; }
        .calculator-btn {
            @apply bg-gray-700/50 hover:bg-gray-600/50 rounded-lg text-2xl font-semibold transition-colors flex items-center justify-center;
        }
    </style>
</head>
<body class="overflow-hidden">

    <audio id="boot-sound" src="bootup/boot.mp3" preload="auto"></audio>
    <div id="power-off-screen" class="hidden absolute inset-0 z-[100] flex flex-col items-center justify-center bg-black transition-opacity duration-500"><h2 id="power-off-message" class="text-2xl font-bold text-white mb-6"></h2></div>

    <!-- Login/Register Screen -->
    <div id="login-container" class="absolute inset-0 z-50 flex flex-col items-center justify-center bg-gray-900 transition-opacity duration-500">
        <div id="login-view">
            <img src="https://placehold.co/128x128/7c3aed/ffffff?text=U" alt="User Avatar" class="rounded-full w-32 h-32 border-4 border-purple-500 mb-4 mx-auto">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Welcome Back</h2>
            <div class="w-full max-w-xs space-y-4"><input id="login-username" type="text" placeholder="Username" class="w-full px-4 py-2 bg-gray-800 border border-gray-700 rounded-md text-white focus:outline-none focus:ring-2 focus:ring-purple-500"><input id="login-password" type="password" placeholder="Password" class="w-full px-4 py-2 bg-gray-800 border border-gray-700 rounded-md text-white focus:outline-none focus:ring-2 focus:ring-purple-500"><button id="sign-in-btn" class="w-full py-2 bg-purple-600 hover:bg-purple-700 rounded-md text-white font-semibold transition-colors">Sign In</button><p class="text-center text-sm text-gray-400">No account? <button id="show-create-account-btn" class="text-purple-400 hover:underline">Create one</button></p></div>
        </div>
        <div id="create-account-view" class="hidden">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">Create Account</h2>
            <div class="w-full max-w-xs space-y-4"><input id="create-username" type="text" placeholder="Username" class="w-full px-4 py-2 bg-gray-800 border border-gray-700 rounded-md text-white focus:outline-none focus:ring-2 focus:ring-purple-500"><input id="create-password" type="password" placeholder="Password" class="w-full px-4 py-2 bg-gray-800 border border-gray-700 rounded-md text-white focus:outline-none focus:ring-2 focus:ring-purple-500"><button id="create-account-btn" class="w-full py-2 bg-green-600 hover:bg-green-700 rounded-md text-white font-semibold transition-colors">Create Account</button><p class="text-center text-sm text-gray-400">Already have an account? <button id="show-login-btn" class="text-purple-400 hover:underline">Sign In</button></p></div>
        </div>
    </div>
    
    <!-- Disclaimer Modal -->
    <div id="disclaimer-modal" class="hidden absolute inset-0 z-[60] flex items-center justify-center bg-black/50">
        <div class="panel p-6 rounded-lg shadow-lg max-w-sm text-center animate-open">
            <h3 class="font-bold text-lg text-white mb-2">Disclaimer</h3>
            <p class="text-sm text-gray-300 mb-4">The background image is a placeholder. All other elements, logic, and designs are generated by an AI. This is a conceptual demonstration and not a final product.</p>
            <button id="disclaimer-ok-btn" class="px-4 py-2 bg-purple-600 hover:bg-purple-700 rounded-md text-white font-semibold">Got it</button>
        </div>
    </div>

    <!-- Desktop Container -->
    <div id="desktop-container" class="h-screen w-screen relative flex flex-col">
        
        <!-- Top Bar -->
        <header class="h-20 w-full p-4 flex items-center space-x-4 panel">
            <span class="text-xl font-bold text-white">Apps</span>
            <button class="top-app-icon h-12 w-12 flex items-center justify-center bg-gray-700/50 hover:bg-gray-600/50 rounded-full transition-colors" data-window="file-explorer-window" title="File Explorer"><span class="material-symbols-outlined text-yellow-400">folder</span></button>
            <button class="top-app-icon h-12 w-12 flex items-center justify-center bg-gray-700/50 hover:bg-gray-600/50 rounded-full transition-colors" data-window="terminal-window" title="Terminal"><span class="material-symbols-outlined">terminal</span></button>
            <button class="top-app-icon h-12 w-12 flex items-center justify-center bg-gray-700/50 hover:bg-gray-600/50 rounded-full transition-colors" data-window="code-editor-window" title="Code Editor"><span class="material-symbols-outlined text-blue-400">data_object</span></button>
            <button class="top-app-icon h-12 w-12 flex items-center justify-center bg-gray-700/50 hover:bg-gray-600/50 rounded-full transition-colors" data-window="calculator-window" title="Calculator"><span class="material-symbols-outlined text-orange-400">calculate</span></button>
            <button class="top-app-icon h-12 w-12 flex items-center justify-center bg-gray-700/50 hover:bg-gray-600/50 rounded-full transition-colors" data-window="weather-window" title="Weather"><span class="material-symbols-outlined text-cyan-400">cloudy</span></button>
            <button class="top-app-icon h-12 w-12 flex items-center justify-center bg-gray-700/50 hover:bg-gray-600/50 rounded-full transition-colors" data-window="music-window" title="Music"><span class="material-symbols-outlined text-pink-400">music_note</span></button>
            <button class="top-app-icon h-12 w-12 flex items-center justify-center bg-gray-700/50 hover:bg-gray-600/50 rounded-full transition-colors" data-window="settings-window" title="Settings"><span class="material-symbols-outlined">settings</span></button>
            <button class="top-app-icon h-12 w-12 flex items-center justify-center bg-gray-700/50 hover:bg-gray-600/50 rounded-full transition-colors" data-window="support-window" title="Support Lifecycle"><span class="material-symbols-outlined text-red-400">support_agent</span></button>
        </header>

        <!-- Main Content Grid -->
        <main class="flex-grow p-8 grid grid-cols-1 lg:grid-cols-3 gap-8">
            <div class="lg:col-span-2 panel rounded-lg p-6">
                 <h2 class="text-3xl font-bold text-white mb-4">Version 1.0.9</h2>
                 <p class="text-gray-300">This update adds the Weather, Music, and Support Lifecycle apps. The system font has also been unified to 'Inter' for a cleaner UI experience.</p>
            </div>
            <div class="lg:col-span-1 flex flex-col space-y-8">
                <div class="panel rounded-lg p-4 text-center">
                    <h3 class="text-lg font-semibold text-gray-400 mb-2">Date</h3>
                    <p id="sidebar-date" class="text-2xl text-white"></p>
                </div>
                 <div class="panel rounded-lg p-4 text-center">
                    <h3 class="text-lg font-semibold text-gray-400 mb-2">Version</h3>
                    <p class="text-2xl text-white">1.0.9</p>
                </div>
                 <div class="panel rounded-lg p-4 text-center">
                    <h3 class="text-lg font-semibold text-gray-400 mb-2">Time</h3>
                    <p id="sidebar-time" class="text-2xl text-white"></p>
                </div>
            </div>
        </main>
        
        <!-- Windows Container (overlays everything) -->
        <div id="windows-container" class="absolute inset-0 w-full h-full pointer-events-none">
             <div id="settings-window" class="window hidden absolute top-1/4 left-1/4 w-full max-w-2xl panel rounded-lg shadow-2xl flex flex-col animate-open pointer-events-auto overflow-hidden"><div class="title-bar flex items-center justify-between p-2 border-b border-white/10"><div class="flex items-center space-x-2"><span class="material-symbols-outlined">settings</span><span>Settings</span></div><button class="close-btn p-1 rounded-full hover:bg-red-500 hover:text-white transition-colors" data-window="settings-window"><span class="material-symbols-outlined">close</span></button></div><div class="flex flex-grow bg-gray-800/50"><div class="w-1/3 p-4 border-r border-white/10 no-scrollbar overflow-y-auto"><h4 class="font-semibold mb-2">System</h4><a href="#about" class="settings-tab block p-2 rounded-lg hover:bg-white/20">About</a><h4 class="font-semibold mb-2 mt-4">Account</h4><a href="#account" class="settings-tab block p-2 rounded-lg hover:bg-white/20">Your Info</a></div><div class="w-2/3 p-4 no-scrollbar overflow-y-auto"><div id="about-content" class="settings-content hidden"><h4 class="font-semibold mb-2">About this PC</h4><div class="space-y-2 text-sm"><div><strong>Device Name:</strong> Win13-Concept</div><div><strong>OS Build:</strong> 1.0.9</div></div></div><div id="account-content" class="settings-content"><h4 class="font-semibold mb-2">Account</h4><div class="flex items-center space-x-4"><img src="https://placehold.co/64x64/7c3aed/ffffff?text=U" class="rounded-full w-16 h-16"><div id="account-username" class="font-semibold">User</div></div></div></div></div><div class="resize-handle"></div></div>
            <div id="file-explorer-window" class="window hidden absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-full max-w-2xl h-96 panel rounded-lg shadow-2xl flex flex-col animate-open pointer-events-auto overflow-hidden"><div class="title-bar flex items-center justify-between p-2 border-b border-white/10"><div class="flex items-center space-x-2"><span class="material-symbols-outlined text-yellow-500">folder</span><span id="file-explorer-path">File Explorer</span></div><div class="flex items-center"><button id="new-file-btn" class="p-1 rounded-full hover:bg-white/20" title="New File"><span class="material-symbols-outlined">note_add</span></button><button class="close-btn p-1 rounded-full hover:bg-red-500 hover:text-white transition-colors" data-window="file-explorer-window"><span class="material-symbols-outlined">close</span></button></div></div><div id="file-explorer-output" class="p-4 flex-grow overflow-y-auto no-scrollbar grid grid-cols-4 gap-4 content-start bg-gray-800/50"></div><div class="resize-handle"></div></div>
            <div id="terminal-window" class="window hidden absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-full max-w-2xl h-96 panel rounded-lg shadow-2xl flex flex-col animate-open pointer-events-auto overflow-hidden"><div class="title-bar flex items-center justify-between p-2 border-b border-white/10"><div class="flex items-center space-x-2"><span class="material-symbols-outlined">terminal</span><span>Terminal</span></div><button class="close-btn p-1 rounded-full hover:bg-red-500 hover:text-white transition-colors" data-window="terminal-window"><span class="material-symbols-outlined">close</span></button></div><div id="terminal-output" class="p-4 flex-grow bg-black/80 font-mono text-white text-sm overflow-y-auto no-scrollbar" onclick="document.getElementById('terminal-input')?.focus()"></div><div class="resize-handle"></div></div>
            <div id="code-editor-window" class="window hidden absolute top-1/4 left-1/4 w-1/2 h-1/2 panel rounded-lg shadow-2xl flex flex-col animate-open pointer-events-auto overflow-hidden"><div class="title-bar flex items-center justify-between p-2 border-b border-white/10"><div class="flex items-center space-x-2"><span class="material-symbols-outlined text-blue-400">data_object</span><span id="code-editor-title">Code Editor</span></div><div><button id="save-file-btn" class="p-1 rounded-full hover:bg-white/20" title="Save File"><span class="material-symbols-outlined">save</span></button><button class="close-btn p-1 rounded-full hover:bg-red-500 hover:text-white transition-colors" data-window="code-editor-window"><span class="material-symbols-outlined">close</span></button></div></div><textarea id="code-editor-textarea" class="w-full h-full p-2 bg-gray-900 text-white font-mono outline-none resize-none"></textarea><div class="resize-handle"></div></div>
            <div id="calculator-window" class="window hidden absolute top-1/4 left-1/4 w-80 h-auto panel rounded-lg shadow-2xl flex flex-col animate-open pointer-events-auto overflow-hidden"><div class="title-bar flex items-center justify-between p-2 border-b border-white/10"><div class="flex items-center space-x-2"><span class="material-symbols-outlined text-orange-400">calculate</span><span>Calculator</span></div><button class="close-btn p-1 rounded-full hover:bg-red-500 hover:text-white transition-colors" data-window="calculator-window"><span class="material-symbols-outlined">close</span></button></div><div class="p-4 bg-gray-800/50 flex flex-col space-y-4"><div id="calc-display" class="w-full bg-black/50 rounded-lg p-4 text-right text-4xl font-mono truncate">0</div><div class="grid grid-cols-4 gap-2"><button class="calculator-btn" data-key="clear">C</button><button class="calculator-btn" data-key="backspace">⌫</button><button class="calculator-btn" data-key="%">%</button><button class="calculator-btn operator" data-key="/">÷</button><button class="calculator-btn" data-key="7">7</button><button class="calculator-btn" data-key="8">8</button><button class="calculator-btn" data-key="9">9</button><button class="calculator-btn operator" data-key="*">×</button><button class="calculator-btn" data-key="4">4</button><button class="calculator-btn" data-key="5">5</button><button class="calculator-btn" data-key="6">6</button><button class="calculator-btn operator" data-key="-">−</button><button class="calculator-btn" data-key="1">1</button><button class="calculator-btn" data-key="2">2</button><button class="calculator-btn" data-key="3">3</button><button class="calculator-btn operator" data-key="+">+</button><button class="calculator-btn col-span-2" data-key="0">0</button><button class="calculator-btn" data-key=".">.</button><button class="calculator-btn operator" data-key="=">=</button></div></div></div>
            <div id="weather-window" class="window hidden absolute top-1/4 left-1/4 w-96 h-auto panel rounded-lg shadow-2xl flex flex-col animate-open pointer-events-auto overflow-hidden"><div class="title-bar flex items-center justify-between p-2 border-b border-white/10"><div class="flex items-center space-x-2"><span class="material-symbols-outlined text-cyan-400">cloudy</span><span>Weather</span></div><button class="close-btn p-1 rounded-full hover:bg-red-500 hover:text-white transition-colors" data-window="weather-window"><span class="material-symbols-outlined">close</span></button></div><div class="p-6 bg-gray-800/50 text-center"><span class="material-symbols-outlined text-9xl text-yellow-300">sunny</span><p class="text-5xl font-bold">75°F</p><p class="text-lg">Clear Skies</p></div></div>
            <div id="music-window" class="window hidden absolute top-1/4 left-1/4 w-96 h-auto panel rounded-lg shadow-2xl flex flex-col animate-open pointer-events-auto overflow-hidden"><div class="title-bar flex items-center justify-between p-2 border-b border-white/10"><div class="flex items-center space-x-2"><span class="material-symbols-outlined text-pink-400">music_note</span><span>Music</span></div><button class="close-btn p-1 rounded-full hover:bg-red-500 hover:text-white transition-colors" data-window="music-window"><span class="material-symbols-outlined">close</span></button></div><div class="p-6 bg-gray-800/50 flex flex-col items-center"><p class="font-semibold">Cyberpunk Dreams</p><p class="text-sm text-gray-400">Synthwave AI</p><div class="w-full h-2 bg-gray-600 rounded-full my-4"><div class="h-2 bg-pink-400 rounded-full w-1/2"></div></div><div class="flex items-center space-x-6 text-4xl"><span class="material-symbols-outlined">skip_previous</span><span class="material-symbols-outlined text-5xl">pause_circle</span><span class="material-symbols-outlined">skip_next</span></div></div></div>
            <div id="support-window" class="window hidden absolute top-1/4 left-1/4 w-full max-w-md h-auto panel rounded-lg shadow-2xl flex flex-col animate-open pointer-events-auto overflow-hidden"><div class="title-bar flex items-center justify-between p-2 border-b border-white/10"><div class="flex items-center space-x-2"><span class="material-symbols-outlined text-red-400">support_agent</span><span>Support Lifecycle</span></div><button class="close-btn p-1 rounded-full hover:bg-red-500 hover:text-white transition-colors" data-window="support-window"><span class="material-symbols-outlined">close</span></button></div><div class="p-6 bg-gray-800/50 text-center"><h4 class="text-lg font-bold">End of Support for Windows 13</h4><p class="text-sm text-gray-400">October 26, 2027</p><div id="support-countdown" class="mt-4 text-2xl font-mono"></div></div></div>
        </div>
    </div>
    <script>
    document.addEventListener('DOMContentLoaded', () => {
        // --- VFS & State ---
        let vfs = { 'C:': { Users: { You: { Desktop: { 'welcome.txt': 'Welcome to Windows 13!' }, Documents: {} } } } };
        let currentPath = "C:/Users/You/Desktop";
        // --- DOM Elements ---
        const loginContainer = document.getElementById('login-container');
        const desktopContainer = document.getElementById('desktop-container');
        const disclaimerModal = document.getElementById('disclaimer-modal');
        const fileExplorerOutput = document.getElementById('file-explorer-output');
        const fileExplorerPathEl = document.getElementById('file-explorer-path');
        const terminalOutput = document.getElementById('terminal-output');
        const sidebarTime = document.getElementById('sidebar-time');
        const sidebarDate = document.getElementById('sidebar-date');
        const codeEditorTextarea = document.getElementById('code-editor-textarea');
        const codeEditorTitle = document.getElementById('code-editor-title');
        const supportCountdownEl = document.getElementById('support-countdown');
        
        // --- Account & Login ---
        document.getElementById('show-create-account-btn').addEventListener('click', () => { document.getElementById('login-view').classList.add('hidden'); document.getElementById('create-account-view').classList.remove('hidden'); });
        document.getElementById('show-login-btn').addEventListener('click', () => { document.getElementById('create-account-view').classList.add('hidden'); document.getElementById('login-view').classList.remove('hidden'); });
        document.getElementById('create-account-btn').addEventListener('click', () => {
            const user = document.getElementById('create-username').value;
            const pass = document.getElementById('create-password').value;
            if (user && pass) { localStorage.setItem(`win13_account_${user}`, pass); alert('Account created!'); document.getElementById('show-login-btn').click(); } 
            else { alert('Please enter a username and password.'); }
        });
        document.getElementById('sign-in-btn').addEventListener('click', () => {
            const user = document.getElementById('login-username').value;
            const pass = document.getElementById('login-password').value;
            const storedPass = localStorage.getItem(`win13_account_${user}`);
            if (storedPass && pass === storedPass) {
                document.getElementById('account-username').textContent = user;
                document.getElementById('boot-sound').play().catch(e => {});
                loginContainer.style.opacity = '0';
                setTimeout(() => {
                    loginContainer.classList.add('hidden');
                    desktopContainer.style.opacity = '1';
                    if (!localStorage.getItem('win13_disclaimer_seen')) { disclaimerModal.classList.remove('hidden'); }
                }, 500);
            } else { alert('Invalid credentials. Create an account if you haven\'t.'); }
        });
        document.getElementById('disclaimer-ok-btn').addEventListener('click', () => {
            disclaimerModal.classList.add('hidden');
            localStorage.setItem('win13_disclaimer_seen', 'true');
        });

        // --- Date, Clock & Countdown ---
        const updateClock = () => {
            const now = new Date();
            const hours = now.getHours();
            const minutes = String(now.getMinutes()).padStart(2, '0');
            const ampm = hours >= 12 ? 'PM' : 'AM';
            sidebarTime.textContent = `${String(hours % 12 || 12)}:${minutes} ${ampm}`;
            sidebarDate.textContent = now.toLocaleDateString(undefined, { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
        };
        const updateCountdown = () => {
            const endDate = new Date('October 26, 2027 00:00:00');
            const now = new Date();
            const diff = endDate - now;
            const days = Math.floor(diff / (1000 * 60 * 60 * 24));
            const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
            if(supportCountdownEl) {
                supportCountdownEl.textContent = `${days}d ${hours}h ${minutes}m`;
            }
        };
        setInterval(updateClock, 1000);
        setInterval(updateCountdown, 1000 * 60);
        updateClock();
        updateCountdown();

        // --- Calculator Logic ---
        const calcDisplay = document.getElementById('calc-display');
        let firstValue = '';
        let operator = '';
        let shouldResetDisplay = false;
        
        document.querySelectorAll('.calculator-btn').forEach(button => {
            button.addEventListener('click', (e) => {
                const key = e.target.dataset.key;
                const isOperator = e.target.classList.contains('operator');
                
                if(!isNaN(key) || key === '.') {
                    if (shouldResetDisplay) { calcDisplay.textContent = ''; shouldResetDisplay = false; }
                    calcDisplay.textContent = calcDisplay.textContent === '0' ? key : calcDisplay.textContent + key;
                } else if(isOperator && key !== '=') {
                    firstValue = calcDisplay.textContent;
                    operator = key;
                    shouldResetDisplay = true;
                } else if (key === '=') {
                    if(operator && firstValue) {
                        const result = eval(`${parseFloat(firstValue)} ${operator} ${parseFloat(calcDisplay.textContent)}`);
                        calcDisplay.textContent = result;
                        firstValue = ''; operator = ''; shouldResetDisplay = true;
                    }
                } else if (key === 'clear') {
                    calcDisplay.textContent = '0'; firstValue = ''; operator = '';
                } else if (key === 'backspace') {
                    calcDisplay.textContent = calcDisplay.textContent.slice(0, -1) || '0';
                }
            });
        });
        
        // --- File System & Explorer ---
        const getObjectFromPath = (path) => path.split('/').filter(p => p).reduce((o, k) => o && o[k] ? o[k] : null, vfs);
        const renderFileExplorer = () => {
            fileExplorerOutput.innerHTML = '';
            fileExplorerPathEl.textContent = currentPath;
            const currentDir = getObjectFromPath(currentPath);
            if (!currentDir) { console.error("Could not find path:", currentPath); return; }
            if (currentPath !== 'C:') {
                const upIcon = document.createElement('div');
                upIcon.className = 'flex flex-col items-center p-2 rounded-lg hover:bg-white/20 cursor-pointer';
                upIcon.innerHTML = `<span class="material-symbols-outlined text-5xl text-yellow-500">subdirectory_arrow_left</span><span class="text-xs text-center truncate w-full">..</span>`;
                upIcon.addEventListener('dblclick', () => {
                    let parts = currentPath.split('/').filter(p => p); parts.pop();
                    currentPath = parts.length > 0 ? parts.join('/') : 'C:';
                    renderFileExplorer();
                });
                fileExplorerOutput.appendChild(upIcon);
            }
            Object.keys(currentDir).forEach(key => {
                const isDir = typeof currentDir[key] === 'object' && currentDir[key] !== null;
                const icon = document.createElement('div');
                icon.className = 'flex flex-col items-center p-2 rounded-lg hover:bg-white/20 cursor-pointer';
                icon.innerHTML = `<span class="material-symbols-outlined text-5xl ${isDir ? 'text-yellow-500' : 'text-gray-300'}">${isDir ? 'folder' : 'draft'}</span><span class="text-xs text-center truncate w-full">${key}</span>`;
                icon.addEventListener('dblclick', () => handleFileExplorerClick(key, isDir));
                fileExplorerOutput.appendChild(icon);
            });
        };
        const handleFileExplorerClick = (name, isDir) => {
            if (isDir) {
                currentPath = `${currentPath}/${name}`.replace('//', '/'); renderFileExplorer();
            } else {
                const fileContent = getObjectFromPath(currentPath)[name];
                openWindow('code-editor-window');
                codeEditorTextarea.value = fileContent; codeEditorTitle.textContent = name;
                codeEditorTextarea.dataset.filePath = `${currentPath}/${name}`.replace('//', '/');
            }
        };
        document.getElementById('save-file-btn').addEventListener('click', () => {
            const path = codeEditorTextarea.dataset.filePath;
            if (!path) return;
            const parts = path.split('/'); const fileName = parts.pop();
            const dir = getObjectFromPath(parts.join('/'));
            if(dir) { dir[fileName] = codeEditorTextarea.value; }
        });
        document.getElementById('new-file-btn').addEventListener('click', () => {
            const fileName = prompt("Enter file name:", "new_file.txt");
            if (fileName) { const currentDir = getObjectFromPath(currentPath); if (currentDir) { currentDir[fileName] = ''; renderFileExplorer(); } }
        });

        // --- Terminal ---
        const processCommand = (cmd) => {
            const [command, ...args] = cmd.trim().split(' '); if (!command) return;
            const append = (text) => appendTerminalOutput(text);
            switch (command.toLowerCase()) {
                case 'ls':
                    const dirContent = getObjectFromPath(currentPath);
                    if (dirContent) append(Object.keys(dirContent).join('  ')); else append('Error: Invalid path');
                    break;
                case 'cd':
                    let newPath = args[0]; if (!newPath) { append('Usage: cd [path]'); break; }
                    if (newPath === '..') {
                        let parts = currentPath.split('/').filter(p => p);
                        if (parts.length > 1) { parts.pop(); currentPath = parts.join('/'); } 
                        else { currentPath = 'C:'; }
                    } else {
                        const targetPath = `${currentPath}/${newPath}`.replace('//', '/');
                        if (getObjectFromPath(targetPath)) { currentPath = targetPath; } 
                        else { append(`Error: Directory not found: ${newPath}`); }
                    }
                    renderFileExplorer();
                    break;
                case 'mkdir':
                    if (!args[0]) { append("Usage: mkdir [directory_name]"); break; }
                    const currentDir = getObjectFromPath(currentPath);
                    if (currentDir) { currentDir[args[0]] = {}; append(`Directory '${args[0]}' created.`); renderFileExplorer(); } 
                    else { append(`Error: Path not found.`); }
                    break;
                case 'restart': append('Restarting...'); setTimeout(() => window.location.reload(), 1000); break;
                default: append(`'${command}' is not recognized.`);
            }
        };
        const createPrompt = () => {
            const promptContainer = document.createElement('div');
            promptContainer.className = 'flex';
            promptContainer.innerHTML = `<span class="text-green-400">${currentPath}>&nbsp;</span><input type="text" id="terminal-input" class="flex-grow bg-transparent border-none outline-none font-mono text-white">`;
            terminalOutput.appendChild(promptContainer);
            const input = document.getElementById('terminal-input');
            input.focus();
            input.addEventListener('keydown', (e) => { if(e.key === 'Enter') handleTerminalInput(e); });
        };
        const handleTerminalInput = (e) => {
            const input = e.target; const cmd = input.value;
            input.parentElement.remove();
            appendTerminalOutput(`<span class="text-green-400">${currentPath}>&nbsp;</span>${cmd}`);
            processCommand(cmd);
            createPrompt();
        };
        const appendTerminalOutput = (text) => { terminalOutput.innerHTML += `<div>${text.replace(/\n/g, '<br>')}</div>`; terminalOutput.scrollTop = terminalOutput.scrollHeight; };

        // --- Window Management ---
        let activeWindow = null, actionType = null, startX, startY, startW, startH, startLeft, startTop;
        const startAction = (e, windowEl, currentAction) => {
            actionType = currentAction; activeWindow = windowEl;
            document.querySelectorAll('.window').forEach(w => w.style.zIndex = '40');
            activeWindow.style.zIndex = '45';
            const event = e.type === 'touchstart' ? e.touches[0] : e;
            startX = event.clientX; startY = event.clientY;
            startW = parseInt(document.defaultView.getComputedStyle(activeWindow).width, 10);
            startH = parseInt(document.defaultView.getComputedStyle(activeWindow).height, 10);
            startLeft = activeWindow.offsetLeft; startTop = activeWindow.offsetTop;
            document.addEventListener('mousemove', doAction); document.addEventListener('mouseup', endAction);
            document.addEventListener('touchmove', doAction, { passive: false }); document.addEventListener('touchend', endAction);
        };
        const doAction = (e) => {
            if (!activeWindow) return; e.preventDefault();
            const event = e.type === 'touchmove' ? e.touches[0] : e;
            const dx = event.clientX - startX; const dy = event.clientY - startY;
            if (actionType === 'drag') {
                activeWindow.style.left = `${startLeft + dx}px`;
                activeWindow.style.top = `${startTop + dy}px`;
            } else if (actionType === 'resize') {
                activeWindow.style.width = `${startW + dx}px`;
                activeWindow.style.height = `${startH + dy}px`;
            }
        };
        const endAction = () => {
            activeWindow = null; actionType = null;
            document.removeEventListener('mousemove', doAction); document.removeEventListener('mouseup', endAction);
            document.removeEventListener('touchmove', doAction); document.removeEventListener('touchend', endAction);
        };
        document.querySelectorAll('.window').forEach(win => {
            const titleBar = win.querySelector('.title-bar');
            const resizeHandle = win.querySelector('.resize-handle');
            if (titleBar) { titleBar.addEventListener('mousedown', e => startAction(e, win, 'drag')); titleBar.addEventListener('touchstart', e => startAction(e, win, 'drag')); }
            if (resizeHandle) { resizeHandle.addEventListener('mousedown', e => startAction(e, win, 'resize')); resizeHandle.addEventListener('touchstart', e => startAction(e, win, 'resize')); }
        });
        
        // --- Init & Other Listeners ---
        const openWindow = (windowId) => {
            const windowEl = document.getElementById(windowId);
            if(windowEl) windowEl.classList.remove('hidden');
            if(windowId === 'terminal-window' && !terminalOutput.hasChildNodes()) createPrompt();
            if(windowId === 'file-explorer-window') renderFileExplorer();
        };
        document.querySelectorAll('[data-window]').forEach(btn => btn.addEventListener('click', e => { e.stopPropagation(); openWindow(btn.getAttribute('data-window')); }));
        document.querySelectorAll('.close-btn').forEach(btn => btn.addEventListener('click', e => { e.stopPropagation(); document.getElementById(btn.getAttribute('data-window')).classList.add('hidden'); }));
        const settingsTabs = document.querySelectorAll('.settings-tab');
        const settingsContents = document.querySelectorAll('.settings-content');
        settingsTabs.forEach(tab => {
            tab.addEventListener('click', (e) => {
                e.preventDefault();
                settingsTabs.forEach(t => t.classList.remove('bg-white/20'));
                tab.classList.add('bg-white/20');
                settingsContents.forEach(content => content.classList.add('hidden'));
                const targetId = tab.getAttribute('href').substring(1) + '-content';
                document.getElementById(targetId).classList.remove('hidden');
            });
        });
        document.querySelector('.settings-tab[href="#about"]')?.click();
    });
    </script>
</body>
</html>
